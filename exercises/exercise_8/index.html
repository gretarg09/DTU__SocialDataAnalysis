<!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="utf-8">
            <title>D3 Test</title>
            <script type="text/javascript" src="/d3/d3.js"></script>
            <link rel="stylesheet" href="/style/myStyle.css">
        </head>
        <body>

        	<div id="area3"></div>
        	<div> 
	        	<p id="knn2" class="p_knn">knn = 2</p>
	            <p id="knn3" class="p_knn">knn = 3</p>
	            <p id="knn4" class="p_knn">knn = 4</p>
	            <p id="knn5" class="p_knn">knn = 5</p>
	            <p id="knn6" class="p_knn">knn = 6</p>
            </div>
            <script type="text/javascript">

            	//Width and height
				var w = 800;
				var h = 600;
				var k = 2;

				var primaryColor = "rgba(135,206,235,1)"

				var projection = d3.geo.mercator()
				    .center([-122.433701, 37.767683])
				    .scale(200000)
				    .translate([w / 2, h / 2]);

				//Define path generator
				var path = d3.geo.path()
					.projection(projection);

				//Define quantize scale to sort data values into buckets of color
				var color = d3.scale.quantize()
					.domain(d3.range(6))
					.range(["yellow","pink","green","red","orange","black"]);

				//Create SVG element
				var svg = d3.select("#area3")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

				//Load in GeoJSON data
				d3.json("https://raw.githubusercontent.com/suneman/socialdataanalysis2017/master/files/sfpddistricts.geojson", function(json){
				//d3.json("us-states.json", function(json) {					
					//Bind data and create one path per GeoJSON feature
					svg.selectAll("path")
					   .data(json.features)
					   .enter()
					   .append("path")
					   .attr("d", path)
					   .style("fill", "steelblue");

					d3.json("kmeans_data_classcombined.json", function(error,json) {
	            		if (error) {  //If error is not null, something went wrong.
	             			console.log(error);  //Log the error.
	            		} 
	            		else {  
	            		    //If no error, the file loaded correctly. Yay!
	              			//console.log(json);  //Log the data.
	              			data_2 = json;
	              			console.log(data_2);

	              			//var classes = getClasses(data_2.knn2);
							//console.log(classes);

							svg.selectAll("circle")
							   .data(data_2.knn2.data)
							   .enter()
							   .append("circle")
							   .attr("cx", function(d) {
								   return projection([d.lon, d.lat])[0];
							   })
							   .attr("cy", function(d) {
								   return projection([d.lon, d.lat])[1];
							   })
							   .attr("r", 3)
							   .style("fill", function(d) {
								   return color(d.class);
							   })
							   .style("opacity", 0.75);

							d3.selectAll("p").filter("#knn2").style("color",primaryColor);
			                d3.selectAll("p")
			                	.filter(".p_knn")
			                	.on("click", function() {
				                	setcolor_knn_p();
				                	var paragraphID = d3.select(this).attr("id");

									d3.selectAll("p")
										.filter("#"+paragraphID)
										.style("color", primaryColor);

									var class_data = getdata_by_class_knn(data_2, paragraphID);
									console.log(class_data);

									//Update all circles
			                        svg.selectAll("circle")
			                        	.data(class_data.data)
			                        	.transition()
			                        	.duration(300)
			                        	.attr("r",3)
			                        	.style("fill", function(d) {
								   			return color(d.class);
							   			});

									/*
									svg.selectAll("circle")
									   .data(data_2.knn2.data)
									   .transition()
									   .append("circle")
									   .attr("cx", function(d) {
										   return projection([d.lon, d.lat])[0];
									   })
									   .attr("cy", function(d) {
										   return projection([d.lon, d.lat])[1];
									   })
									   .attr("r", 3)
									   .style("fill", function(d) {
										   return color(d.class);
									   })
									   .style("opacity", 0.75);
									   */

					            });
	          			}	
	          		});
				});

				function setcolor_knn_p() {
   					d3.selectAll("p")
   						.filter(".p_knn")
   						.style("color", "black");
				}

				function getdata_by_class_knn(data,knn_class){
					if(knn_class == "knn2"){
						return data.knn2;
					}
					if(knn_class == "knn3"){
						return data.knn3;
					}
					if(knn_class == "knn4"){
						return data.knn4;
					}
					if(knn_class == "knn5"){
						return data.knn5;
					}
					if(knn_class == "knn6"){
						return data.knn6;
					}
				}
				
            </script>
        </body>
</html>